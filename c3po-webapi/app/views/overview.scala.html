@(collections: List[String], filterform: Form[helpers.Filter], graphs: helpers.GraphData, stats: helpers.Statistics)
@import helper._

@main("c3po", collections) {
<script type="text/javascript">
           $(function(){
               //when some select is chosen, submit the form
               $("select").click(function() {
                   $('#filterform').submit();
               });

               // when some input radio is chosen 
               // remove the class selected filter from all
               // then add it to the chosen one. 
               $("input").change(function(){
                 $('input').each(function(){
                        $(this).parent().removeClass("selected_filter");
                     });
                   
                   $(this).parent().addClass("selected_filter");
                   $('#filterform').submit();
                });
           });

          
</script>
<div class="container">
<div class = "span-24 selector last">
 @form(action = routes.Overview.show, args = 'id -> "filterform") {
 <div id="clear">
            <a href="/overview"></a>
        </div>
<div class="selection ">
      <ul>
         <li>@select(
         field = filterform("collection"),
          options = options(collections),
          args = '_label -> "Collections"
         )</li>
          <li>
        @select(
            field = filterform("filter"), 
            options = options(
                "none" -> "none",
                "mimetype" -> "mimetype",
                "format" -> "format"
            ),
            args = '_label -> "Filters",
            '_id -> "sel_filter"
        )</li>
        </ul>
        
  </div>
    
   <div class="title">
        <h2>Select filter options</h2>
  </div>
  
    @if(filterform.get().getValues() != null) {
    <div class="filtervalues">
        <ul>
        @for(v <- filterform.get().getValues()) {
         <li>
            <input type="radio" name="value" value="@v" id="@v"/>
            <label for="@v">@v</label>
         </li>
        }  
        </ul> 
     </div>
     }         
     <input id="offset" type="hidden" name="offset" value="0">
  }
 
    </div>
    </div>

<div class="container">
 @if(filterform.get() != null && !filterform.get().getValues().isEmpty()) {
<script type = "text/javascript">
       $(function() {
           function url_query( query ) {
                query = query.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
                var expr = "[\\?&]"+query+"=([^&#]*)";
                var regex = new RegExp( expr );
                var results = regex.exec( window.location.href );
                if( results !== null ) {
                    return results[1];
                    return decodeURIComponent(results[1].replace(/\+/g, " "));
                } else {
                    return 0;
                }
            }
             
            // Example usage - http://www.kevinleary.net/?load=yes
         var offset = url_query('offset');
         $('#offset').val(offset);
         $('input[id="@filterform.get().getValue()"]').prop('checked', true);
         $('input[id="@filterform.get().getValue()"]').parent().addClass("selected_filter");
       });
</script>
}

@if(graphs != null) {
<script type="text/javascript">
$(document).ready(function(){
    // For horizontal bar charts, x an y values must will be "flipped"
    // from their vertical bar counterpart.
    
        @for(g <- graphs.getGraphs()) {
            @if(g.getProperty().equals("mimetype")) {
            	var mimes = [  @for((k, i) <- g.getKeys().zipWithIndex){
                    ['@k', @g.getValues().get(i)],
                  }
                ]
            } 

            @if(g.getProperty().equals("format")) {
            	var formats = [  @for((k, i) <- g.getKeys().zipWithIndex){
                    ['@k', @g.getValues().get(i)],
                  }
                ]
            }

            @if(g.getProperty().equals("format_version")) {
                var fv = [  @for((k, i) <- g.getKeys().zipWithIndex){
                    ['@k', @g.getValues().get(i)],
                  }
                ]
            }

            @if(g.getProperty().equals("valid")) {
                var valid = [  @for((k, i) <- g.getKeys().zipWithIndex){
                    ['@k', @g.getValues().get(i)],
                  }
                ]
            }

            @if(g.getProperty().equals("wellformed")) {
                var wellformed = [  @for((k, i) <- g.getKeys().zipWithIndex){
                    ['@k', @g.getValues().get(i)],
                  }
                ]
            }
         }
    ;

    function getOptions(ttl) {
    	var options = {
                title: ttl,
                seriesDefaults: {
                    renderer:$.jqplot.BarRenderer,
                    // Show point labels to the right ('e'ast) of each bar.
                    // edgeTolerance of -15 allows labels flow outside the grid
                    // up to 15 pixels.  If they flow out more than that, they 
                    // will be hidden.
                    pointLabels: { show: true, location: 'n', edgeTolerance: -15 },
                    // Rotate the bar shadow as if bar is lit from top right.
                    shadowAngle: 70,
                    // Here's where we tell the chart it is oriented horizontally.
                    rendererOptions: {
                        barDirection: 'vertical',
                        barWidth: '25',
                    },
                    color: '#639B00'
                },
                axesDefaults: {
                    tickRenderer: $.jqplot.CanvasAxisTickRenderer ,
                    tickOptions: {
                      angle: -30,
                      fontSize: '10pt'
                    }
                },
                axes: {
                    // Use a category axis on the x axis and use our custom ticks.
                    xaxis: {
                        renderer: $.jqplot.CategoryAxisRenderer,
                    },
                    // Pad the y axis just a little so bars can get close to, but
                    // not touch, the grid boundaries.  1.2 is the default padding.
                    yaxis: {
                        pad: 1.05,
                        tickOptions: {formatString: '%d'}
                    }
                },
                sortData: true
            };

        return options;
    };
    
    var plot1 = $.jqplot('mimetypehistogramm', [mimes], getOptions("Mime Types"));
    var plot2 = $.jqplot('formathistogramm', [formats], getOptions("Formats"));
    var plot3 = $.jqplot('versionshistogramm', [fv], getOptions("Format Versions"));
    var plot4 = $.jqplot('validhistogramm', [valid], getOptions("Valid"));
    var plot5 = $.jqplot('wellformedhistogramm', [wellformed], getOptions("Well Formed"));
});


</script>
}   
<div class="content span-24">
    <div class="span-18">
    <h1>
        @if(filterform("collection").value() != null) {
            Collection '@filterform("collection").value()' -
        }
     Figures and Diagrams</h1>
     <div id="mimetypehistogramm" class="dia"></div>
     <div id="formathistogramm" class="dia"></div>
     <div id="versionshistogramm" class="dia"></div>
     <div id="validhistogramm" class="dia"></div>
     <div id="wellformedhistogramm" class="dia"></div>
     
    </div>
    
     @if(stats != null) {
        <div id="statistics" class="span-4 last">
            <h4>Size Stats</h4><br/>
            Count : @stats.getCount()<br />
            Size : @stats.getSize() <br />
            Min :  @stats.getMin() <br />
            Max :  @stats.getMax() <br />
            Average :  @stats.getAvg() <br />
            SD :  @stats.getSd() <br />
            Var :  @stats.getVar() <br />
            
         </div>
          } else {
          <div class="span-10 last">
            Please select a collection
          </div>
          }
     
    </div>
    
</div>
}